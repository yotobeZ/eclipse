package jdbc;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import com.mysql.jdbc.PreparedStatement;

import charactor.Student;

public class schDAO {
	public schDAO() {
		try {
			Class.forName("com.mysql.jdbc.Driver");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}
	}

	public Connection getConnection() throws SQLException {
		return DriverManager.getConnection("jdbc:mysql://127.0.0.1:3306/school?characterEncoding=UTF-8", "root",
				"admin");
	}
	
	public List<Sschool> list(int start, int count) {
		 List<Sschool> sschools = new ArrayList<Sschool>();


			String sql = "select * from sschool order by id asc limit ?,? ";

			try (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) {

				ps.setInt(1, start);
				ps.setInt(2, count);

				ResultSet rs = ps.executeQuery();

				while (rs.next()) {
					Sschool sschool = new Sschool();
					int id = rs.getInt(1);
					String sname = rs.getString(2);
					int sage = rs.getInt(3);
					String ssex = rs.getString(4);
					String shobby = rs.getString(5);
					int sschool = rs.getInt(6);
					int smajor = rs.getInt(7);

					String sql1 = "select * from sschool where id=" + sschool;
					Statement s1 = c.createStatement();
					ResultSet rs1 = s1.executeQuery(sql1);
					// ResultSet rs1 = s.execute(sql1);
					if (rs1.next()) {
						String scname = rs1.getString("scname");
						student.sschool = scname;
					}

					String sql2 = "select * from smajor where id=" + smajor;
					Statement s2 = c.createStatement();
					ResultSet rs2 = s2.executeQuery(sql2);
					// ResultSet rs1 = s.execute(sql1);
					if (rs2.next()) {
						String mname = rs2.getString("mname");
						student.smajor = mname;
					}

					student.sname = sname;
					student.sage = sage;
					student.ssex = ssex;
					student.shobby = shobby;
					// student.sschool = scname;
					// student.smajor = smajor;
					student.id = id;
					students.add(student);
				}
			} catch (SQLException e) {

				e.printStackTrace();
			}
			return students;
		

			


}
